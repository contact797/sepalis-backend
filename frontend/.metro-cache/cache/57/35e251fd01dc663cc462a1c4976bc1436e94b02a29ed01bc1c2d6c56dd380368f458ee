{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":78,"index":78}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"../services/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":79},"end":{"line":2,"column":50,"index":129}}],"key":"Pr5/EB33W7mJGi+ygccy+pUf1E8=","exportNames":["*"],"imports":1}},{"name":"../services/subscriptionService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":130},"end":{"line":3,"column":70,"index":200}}],"key":"OgD6el2kk1jS7clhhI4rltOEtH8=","exportNames":["*"],"imports":1}},{"name":"./AuthContext","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":201},"end":{"line":4,"column":40,"index":241}}],"key":"YmpzODa+dVz64UAAYTI+RwJeEt0=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/contexts/SubscriptionContext.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.SubscriptionProvider = SubscriptionProvider;\n  exports.useSubscription = useSubscription;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _servicesApi = require(_dependencyMap[1], \"../services/api\");\n  var _servicesSubscriptionService = require(_dependencyMap[2], \"../services/subscriptionService\");\n  var _AuthContext = require(_dependencyMap[3], \"./AuthContext\");\n  var _reactJsxDevRuntime = require(_dependencyMap[4], \"react/jsx-dev-runtime\");\n  const SubscriptionContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  function SubscriptionProvider({\n    children\n  }) {\n    _s();\n    const {\n      user\n    } = (0, _AuthContext.useAuth)();\n    const [isPremium, setIsPremium] = (0, _react.useState)(false);\n    const [isTrial, setIsTrial] = (0, _react.useState)(false);\n    const [isLoading, setIsLoading] = (0, _react.useState)(true);\n    const [expiresAt, setExpiresAt] = (0, _react.useState)(null);\n    (0, _react.useEffect)(() => {\n      if (user) {\n        initializeSubscription();\n      }\n    }, [user]);\n    const initializeSubscription = async () => {\n      try {\n        // Initialiser RevenueCat avec l'ID utilisateur\n        if (user?._id) {\n          await _servicesSubscriptionService.subscriptionService.initialize(user._id);\n        }\n\n        // Vérifier le statut de l'abonnement\n        await checkSubscription();\n      } catch (error) {\n        console.error('Erreur initialisation abonnement:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    const checkSubscription = async () => {\n      try {\n        setIsLoading(true);\n\n        // Vérifier depuis le backend\n        const response = await _servicesApi.subscriptionAPI.getStatus();\n        const status = response.data;\n        setIsPremium(status.isActive);\n        setIsTrial(status.isTrial);\n        setExpiresAt(status.expiresAt ? new Date(status.expiresAt) : null);\n\n        // Vérifier aussi depuis RevenueCat (plus à jour)\n        const revenueCatStatus = await _servicesSubscriptionService.subscriptionService.checkSubscription();\n\n        // Prendre le plus permissif (si l'un dit premium, c'est premium)\n        if (revenueCatStatus.isActive && !status.isActive) {\n          setIsPremium(true);\n          setIsTrial(revenueCatStatus.isTrial);\n          setExpiresAt(revenueCatStatus.expiresAt);\n        }\n      } catch (error) {\n        console.error('Erreur vérification abonnement:', error);\n        // En cas d'erreur, on donne accès (meilleure UX)\n        setIsPremium(true);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    const startTrial = async () => {\n      try {\n        const response = await _servicesApi.subscriptionAPI.startTrial();\n        if (response.data.success) {\n          setIsPremium(true);\n          setIsTrial(true);\n          setExpiresAt(new Date(response.data.expiresAt));\n          return true;\n        }\n        return false;\n      } catch (error) {\n        console.error('Erreur démarrage essai:', error);\n        return false;\n      }\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(SubscriptionContext.Provider, {\n      value: {\n        isPremium,\n        isTrial,\n        isLoading,\n        expiresAt,\n        checkSubscription,\n        startTrial\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 5\n    }, this);\n  }\n  _s(SubscriptionProvider, \"uQpEX24OyT/ucjRmj7Sea97uQPk=\", false, function () {\n    return [_AuthContext.useAuth];\n  });\n  _c = SubscriptionProvider;\n  function useSubscription() {\n    _s2();\n    const context = (0, _react.useContext)(SubscriptionContext);\n    if (context === undefined) {\n      throw new Error('useSubscription must be used within a SubscriptionProvider');\n    }\n    return context;\n  }\n  _s2(useSubscription, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n  var _c;\n  $RefreshReg$(_c, \"SubscriptionProvider\");\n});","lineCount":123,"map":[[10,2,17,0,"exports"],[10,9,17,0],[10,10,17,0,"SubscriptionProvider"],[10,30,17,0],[10,33,17,0,"SubscriptionProvider"],[10,53,17,0],[11,2,111,0,"exports"],[11,9,111,0],[11,10,111,0,"useSubscription"],[11,25,111,0],[11,28,111,0,"useSubscription"],[11,43,111,0],[12,2,1,0],[12,6,1,0,"_react"],[12,12,1,0],[12,15,1,0,"require"],[12,22,1,0],[12,23,1,0,"_dependencyMap"],[12,37,1,0],[13,2,2,0],[13,6,2,0,"_servicesApi"],[13,18,2,0],[13,21,2,0,"require"],[13,28,2,0],[13,29,2,0,"_dependencyMap"],[13,43,2,0],[14,2,3,0],[14,6,3,0,"_servicesSubscriptionService"],[14,34,3,0],[14,37,3,0,"require"],[14,44,3,0],[14,45,3,0,"_dependencyMap"],[14,59,3,0],[15,2,4,0],[15,6,4,0,"_AuthContext"],[15,18,4,0],[15,21,4,0,"require"],[15,28,4,0],[15,29,4,0,"_dependencyMap"],[15,43,4,0],[16,2,4,40],[16,6,4,40,"_reactJsxDevRuntime"],[16,25,4,40],[16,28,4,40,"require"],[16,35,4,40],[16,36,4,40,"_dependencyMap"],[16,50,4,40],[17,2,15,0],[17,8,15,6,"SubscriptionContext"],[17,27,15,25],[17,43,15,28],[17,47,15,28,"createContext"],[17,53,15,41],[17,54,15,41,"createContext"],[17,67,15,41],[17,69,15,79,"undefined"],[17,78,15,88],[17,79,15,89],[18,2,17,7],[18,11,17,16,"SubscriptionProvider"],[18,31,17,36,"SubscriptionProvider"],[18,32,17,37],[19,4,17,39,"children"],[20,2,17,79],[20,3,17,80],[20,5,17,82],[21,4,17,82,"_s"],[21,6,17,82],[22,4,18,2],[22,10,18,8],[23,6,18,10,"user"],[24,4,18,15],[24,5,18,16],[24,8,18,19],[24,12,18,19,"useAuth"],[24,24,18,26],[24,25,18,26,"useAuth"],[24,32,18,26],[24,34,18,27],[24,35,18,28],[25,4,19,2],[25,10,19,8],[25,11,19,9,"isPremium"],[25,20,19,18],[25,22,19,20,"setIsPremium"],[25,34,19,32],[25,35,19,33],[25,38,19,36],[25,42,19,36,"useState"],[25,48,19,44],[25,49,19,44,"useState"],[25,57,19,44],[25,59,19,45],[25,64,19,50],[25,65,19,51],[26,4,20,2],[26,10,20,8],[26,11,20,9,"isTrial"],[26,18,20,16],[26,20,20,18,"setIsTrial"],[26,30,20,28],[26,31,20,29],[26,34,20,32],[26,38,20,32,"useState"],[26,44,20,40],[26,45,20,40,"useState"],[26,53,20,40],[26,55,20,41],[26,60,20,46],[26,61,20,47],[27,4,21,2],[27,10,21,8],[27,11,21,9,"isLoading"],[27,20,21,18],[27,22,21,20,"setIsLoading"],[27,34,21,32],[27,35,21,33],[27,38,21,36],[27,42,21,36,"useState"],[27,48,21,44],[27,49,21,44,"useState"],[27,57,21,44],[27,59,21,45],[27,63,21,49],[27,64,21,50],[28,4,22,2],[28,10,22,8],[28,11,22,9,"expiresAt"],[28,20,22,18],[28,22,22,20,"setExpiresAt"],[28,34,22,32],[28,35,22,33],[28,38,22,36],[28,42,22,36,"useState"],[28,48,22,44],[28,49,22,44,"useState"],[28,57,22,44],[28,59,22,58],[28,63,22,62],[28,64,22,63],[29,4,24,2],[29,8,24,2,"useEffect"],[29,14,24,11],[29,15,24,11,"useEffect"],[29,24,24,11],[29,26,24,12],[29,32,24,18],[30,6,25,4],[30,10,25,8,"user"],[30,14,25,12],[30,16,25,14],[31,8,26,6,"initializeSubscription"],[31,30,26,28],[31,31,26,29],[31,32,26,30],[32,6,27,4],[33,4,28,2],[33,5,28,3],[33,7,28,5],[33,8,28,6,"user"],[33,12,28,10],[33,13,28,11],[33,14,28,12],[34,4,30,2],[34,10,30,8,"initializeSubscription"],[34,32,30,30],[34,35,30,33],[34,41,30,33,"initializeSubscription"],[34,42,30,33],[34,47,30,45],[35,6,31,4],[35,10,31,8],[36,8,32,6],[37,8,33,6],[37,12,33,10,"user"],[37,16,33,14],[37,18,33,16,"_id"],[37,21,33,19],[37,23,33,21],[38,10,34,8],[38,16,34,14,"subscriptionService"],[38,44,34,33],[38,45,34,33,"subscriptionService"],[38,64,34,33],[38,65,34,34,"initialize"],[38,75,34,44],[38,76,34,45,"user"],[38,80,34,49],[38,81,34,50,"_id"],[38,84,34,53],[38,85,34,54],[39,8,35,6],[41,8,37,6],[42,8,38,6],[42,14,38,12,"checkSubscription"],[42,31,38,29],[42,32,38,30],[42,33,38,31],[43,6,39,4],[43,7,39,5],[43,8,39,6],[43,15,39,13,"error"],[43,20,39,18],[43,22,39,20],[44,8,40,6,"console"],[44,15,40,13],[44,16,40,14,"error"],[44,21,40,19],[44,22,40,20],[44,57,40,55],[44,59,40,57,"error"],[44,64,40,62],[44,65,40,63],[45,6,41,4],[45,7,41,5],[45,16,41,14],[46,8,42,6,"setIsLoading"],[46,20,42,18],[46,21,42,19],[46,26,42,24],[46,27,42,25],[47,6,43,4],[48,4,44,2],[48,5,44,3],[49,4,46,2],[49,10,46,8,"checkSubscription"],[49,27,46,25],[49,30,46,28],[49,36,46,28,"checkSubscription"],[49,37,46,28],[49,42,46,40],[50,6,47,4],[50,10,47,8],[51,8,48,6,"setIsLoading"],[51,20,48,18],[51,21,48,19],[51,25,48,23],[51,26,48,24],[53,8,50,6],[54,8,51,6],[54,14,51,12,"response"],[54,22,51,20],[54,25,51,23],[54,31,51,29,"subscriptionAPI"],[54,43,51,44],[54,44,51,44,"subscriptionAPI"],[54,59,51,44],[54,60,51,45,"getStatus"],[54,69,51,54],[54,70,51,55],[54,71,51,56],[55,8,52,6],[55,14,52,12,"status"],[55,20,52,18],[55,23,52,21,"response"],[55,31,52,29],[55,32,52,30,"data"],[55,36,52,34],[56,8,54,6,"setIsPremium"],[56,20,54,18],[56,21,54,19,"status"],[56,27,54,25],[56,28,54,26,"isActive"],[56,36,54,34],[56,37,54,35],[57,8,55,6,"setIsTrial"],[57,18,55,16],[57,19,55,17,"status"],[57,25,55,23],[57,26,55,24,"isTrial"],[57,33,55,31],[57,34,55,32],[58,8,56,6,"setExpiresAt"],[58,20,56,18],[58,21,56,19,"status"],[58,27,56,25],[58,28,56,26,"expiresAt"],[58,37,56,35],[58,40,56,38],[58,44,56,42,"Date"],[58,48,56,46],[58,49,56,47,"status"],[58,55,56,53],[58,56,56,54,"expiresAt"],[58,65,56,63],[58,66,56,64],[58,69,56,67],[58,73,56,71],[58,74,56,72],[60,8,58,6],[61,8,59,6],[61,14,59,12,"revenueCatStatus"],[61,30,59,28],[61,33,59,31],[61,39,59,37,"subscriptionService"],[61,67,59,56],[61,68,59,56,"subscriptionService"],[61,87,59,56],[61,88,59,57,"checkSubscription"],[61,105,59,74],[61,106,59,75],[61,107,59,76],[63,8,61,6],[64,8,62,6],[64,12,62,10,"revenueCatStatus"],[64,28,62,26],[64,29,62,27,"isActive"],[64,37,62,35],[64,41,62,39],[64,42,62,40,"status"],[64,48,62,46],[64,49,62,47,"isActive"],[64,57,62,55],[64,59,62,57],[65,10,63,8,"setIsPremium"],[65,22,63,20],[65,23,63,21],[65,27,63,25],[65,28,63,26],[66,10,64,8,"setIsTrial"],[66,20,64,18],[66,21,64,19,"revenueCatStatus"],[66,37,64,35],[66,38,64,36,"isTrial"],[66,45,64,43],[66,46,64,44],[67,10,65,8,"setExpiresAt"],[67,22,65,20],[67,23,65,21,"revenueCatStatus"],[67,39,65,37],[67,40,65,38,"expiresAt"],[67,49,65,47],[67,50,65,48],[68,8,66,6],[69,6,68,4],[69,7,68,5],[69,8,68,6],[69,15,68,13,"error"],[69,20,68,18],[69,22,68,20],[70,8,69,6,"console"],[70,15,69,13],[70,16,69,14,"error"],[70,21,69,19],[70,22,69,20],[70,55,69,53],[70,57,69,55,"error"],[70,62,69,60],[70,63,69,61],[71,8,70,6],[72,8,71,6,"setIsPremium"],[72,20,71,18],[72,21,71,19],[72,25,71,23],[72,26,71,24],[73,6,72,4],[73,7,72,5],[73,16,72,14],[74,8,73,6,"setIsLoading"],[74,20,73,18],[74,21,73,19],[74,26,73,24],[74,27,73,25],[75,6,74,4],[76,4,75,2],[76,5,75,3],[77,4,77,2],[77,10,77,8,"startTrial"],[77,20,77,18],[77,23,77,21],[77,29,77,21,"startTrial"],[77,30,77,21],[77,35,77,51],[78,6,78,4],[78,10,78,8],[79,8,79,6],[79,14,79,12,"response"],[79,22,79,20],[79,25,79,23],[79,31,79,29,"subscriptionAPI"],[79,43,79,44],[79,44,79,44,"subscriptionAPI"],[79,59,79,44],[79,60,79,45,"startTrial"],[79,70,79,55],[79,71,79,56],[79,72,79,57],[80,8,81,6],[80,12,81,10,"response"],[80,20,81,18],[80,21,81,19,"data"],[80,25,81,23],[80,26,81,24,"success"],[80,33,81,31],[80,35,81,33],[81,10,82,8,"setIsPremium"],[81,22,82,20],[81,23,82,21],[81,27,82,25],[81,28,82,26],[82,10,83,8,"setIsTrial"],[82,20,83,18],[82,21,83,19],[82,25,83,23],[82,26,83,24],[83,10,84,8,"setExpiresAt"],[83,22,84,20],[83,23,84,21],[83,27,84,25,"Date"],[83,31,84,29],[83,32,84,30,"response"],[83,40,84,38],[83,41,84,39,"data"],[83,45,84,43],[83,46,84,44,"expiresAt"],[83,55,84,53],[83,56,84,54],[83,57,84,55],[84,10,85,8],[84,17,85,15],[84,21,85,19],[85,8,86,6],[86,8,88,6],[86,15,88,13],[86,20,88,18],[87,6,89,4],[87,7,89,5],[87,8,89,6],[87,15,89,13,"error"],[87,20,89,18],[87,22,89,20],[88,8,90,6,"console"],[88,15,90,13],[88,16,90,14,"error"],[88,21,90,19],[88,22,90,20],[88,47,90,45],[88,49,90,47,"error"],[88,54,90,52],[88,55,90,53],[89,8,91,6],[89,15,91,13],[89,20,91,18],[90,6,92,4],[91,4,93,2],[91,5,93,3],[92,4,95,2],[92,24,96,4],[92,28,96,4,"_reactJsxDevRuntime"],[92,47,96,4],[92,48,96,4,"jsxDEV"],[92,54,96,4],[92,56,96,5,"SubscriptionContext"],[92,75,96,24],[92,76,96,25,"Provider"],[92,84,96,33],[93,6,97,6,"value"],[93,11,97,11],[93,13,97,13],[94,8,98,8,"isPremium"],[94,17,98,17],[95,8,99,8,"isTrial"],[95,15,99,15],[96,8,100,8,"isLoading"],[96,17,100,17],[97,8,101,8,"expiresAt"],[97,17,101,17],[98,8,102,8,"checkSubscription"],[98,25,102,25],[99,8,103,8,"startTrial"],[100,6,104,6],[100,7,104,8],[101,6,104,8,"children"],[101,14,104,8],[101,16,106,7,"children"],[102,4,106,15],[103,6,106,15,"fileName"],[103,14,106,15],[103,16,106,15,"_jsxFileName"],[103,28,106,15],[104,6,106,15,"lineNumber"],[104,16,106,15],[105,6,106,15,"columnNumber"],[105,18,106,15],[106,4,106,15],[106,11,107,34],[106,12,107,35],[107,2,109,0],[108,2,109,1,"_s"],[108,4,109,1],[108,5,17,16,"SubscriptionProvider"],[108,25,17,36],[109,4,17,36],[109,12,18,19,"useAuth"],[109,24,18,26],[109,25,18,26,"useAuth"],[109,32,18,26],[110,2,18,26],[111,2,18,26,"_c"],[111,4,18,26],[111,7,17,16,"SubscriptionProvider"],[111,27,17,36],[112,2,111,7],[112,11,111,16,"useSubscription"],[112,26,111,31,"useSubscription"],[112,27,111,31],[112,29,111,34],[113,4,111,34,"_s2"],[113,7,111,34],[114,4,112,2],[114,10,112,8,"context"],[114,17,112,15],[114,20,112,18],[114,24,112,18,"useContext"],[114,30,112,28],[114,31,112,28,"useContext"],[114,41,112,28],[114,43,112,29,"SubscriptionContext"],[114,62,112,48],[114,63,112,49],[115,4,113,2],[115,8,113,6,"context"],[115,15,113,13],[115,20,113,18,"undefined"],[115,29,113,27],[115,31,113,29],[116,6,114,4],[116,12,114,10],[116,16,114,14,"Error"],[116,21,114,19],[116,22,114,20],[116,82,114,80],[116,83,114,81],[117,4,115,2],[118,4,116,2],[118,11,116,9,"context"],[118,18,116,16],[119,2,117,0],[120,2,117,1,"_s2"],[120,5,117,1],[120,6,111,16,"useSubscription"],[120,21,111,31],[121,2,111,31],[121,6,111,31,"_c"],[121,8,111,31],[122,2,111,31,"$RefreshReg$"],[122,14,111,31],[122,15,111,31,"_c"],[122,17,111,31],[123,0,111,31],[123,3]],"functionMap":{"names":["<global>","SubscriptionProvider","useEffect$argument_0","initializeSubscription","checkSubscription","startTrial","useSubscription"],"mappings":"AAA;OCgB;YCO;GDI;iCEE;GFc;4BGE;GH6B;qBIE;GJgB;CDgB;OME;CNM"},"hasCjsExports":false},"type":"js/module"}]}