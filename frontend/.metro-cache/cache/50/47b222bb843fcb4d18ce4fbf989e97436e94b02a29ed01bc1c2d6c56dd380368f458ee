{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":78,"index":78}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"../services/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":79},"end":{"line":2,"column":50,"index":129}}],"key":"Pr5/EB33W7mJGi+ygccy+pUf1E8=","exportNames":["*"],"imports":1}},{"name":"../services/subscriptionService","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":130},"end":{"line":3,"column":70,"index":200}}],"key":"OgD6el2kk1jS7clhhI4rltOEtH8=","exportNames":["*"],"imports":1}},{"name":"./AuthContext","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":201},"end":{"line":4,"column":40,"index":241}}],"key":"YmpzODa+dVz64UAAYTI+RwJeEt0=","exportNames":["*"],"imports":1}},{"name":"react/jsx-dev-runtime","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"L9D70Z4hi4aGuui1ysja/oQ5ytI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _jsxFileName = \"/app/frontend/contexts/SubscriptionContext.tsx\";\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.SubscriptionProvider = SubscriptionProvider;\n  exports.useSubscription = useSubscription;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _servicesApi = require(_dependencyMap[1], \"../services/api\");\n  var _servicesSubscriptionService = require(_dependencyMap[2], \"../services/subscriptionService\");\n  var _AuthContext = require(_dependencyMap[3], \"./AuthContext\");\n  var _reactJsxDevRuntime = require(_dependencyMap[4], \"react/jsx-dev-runtime\");\n  const SubscriptionContext = /*#__PURE__*/(0, _react.createContext)(undefined);\n  function SubscriptionProvider({\n    children\n  }) {\n    const {\n      user\n    } = (0, _AuthContext.useAuth)();\n    const [isPremium, setIsPremium] = (0, _react.useState)(false);\n    const [isTrial, setIsTrial] = (0, _react.useState)(false);\n    const [isLoading, setIsLoading] = (0, _react.useState)(true);\n    const [expiresAt, setExpiresAt] = (0, _react.useState)(null);\n    (0, _react.useEffect)(() => {\n      if (user) {\n        initializeSubscription();\n      }\n    }, [user]);\n    const initializeSubscription = async () => {\n      try {\n        // Initialiser RevenueCat avec l'ID utilisateur\n        if (user?._id) {\n          await _servicesSubscriptionService.subscriptionService.initialize(user._id);\n        }\n\n        // Vérifier le statut de l'abonnement\n        await checkSubscription();\n      } catch (error) {\n        console.error('Erreur initialisation abonnement:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    const checkSubscription = async () => {\n      try {\n        setIsLoading(true);\n\n        // Vérifier depuis le backend\n        const response = await _servicesApi.subscriptionAPI.getStatus();\n        const status = response.data;\n        setIsPremium(status.isActive);\n        setIsTrial(status.isTrial);\n        setExpiresAt(status.expiresAt ? new Date(status.expiresAt) : null);\n\n        // Vérifier aussi depuis RevenueCat (plus à jour)\n        const revenueCatStatus = await _servicesSubscriptionService.subscriptionService.checkSubscription();\n\n        // Prendre le plus permissif (si l'un dit premium, c'est premium)\n        if (revenueCatStatus.isActive && !status.isActive) {\n          setIsPremium(true);\n          setIsTrial(revenueCatStatus.isTrial);\n          setExpiresAt(revenueCatStatus.expiresAt);\n        }\n      } catch (error) {\n        console.error('Erreur vérification abonnement:', error);\n        // En cas d'erreur, on donne accès (meilleure UX)\n        setIsPremium(true);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    const startTrial = async () => {\n      try {\n        const response = await _servicesApi.subscriptionAPI.startTrial();\n        if (response.data.success) {\n          setIsPremium(true);\n          setIsTrial(true);\n          setExpiresAt(new Date(response.data.expiresAt));\n          return true;\n        }\n        return false;\n      } catch (error) {\n        console.error('Erreur démarrage essai:', error);\n        return false;\n      }\n    };\n    return /*#__PURE__*/(0, _reactJsxDevRuntime.jsxDEV)(SubscriptionContext.Provider, {\n      value: {\n        isPremium,\n        isTrial,\n        isLoading,\n        expiresAt,\n        checkSubscription,\n        startTrial\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 5\n    }, this);\n  }\n  function useSubscription() {\n    const context = (0, _react.useContext)(SubscriptionContext);\n    if (context === undefined) {\n      throw new Error('useSubscription must be used within a SubscriptionProvider');\n    }\n    return context;\n  }\n});","lineCount":112,"map":[[8,2,17,0,"exports"],[8,9,17,0],[8,10,17,0,"SubscriptionProvider"],[8,30,17,0],[8,33,17,0,"SubscriptionProvider"],[8,53,17,0],[9,2,111,0,"exports"],[9,9,111,0],[9,10,111,0,"useSubscription"],[9,25,111,0],[9,28,111,0,"useSubscription"],[9,43,111,0],[10,2,1,0],[10,6,1,0,"_react"],[10,12,1,0],[10,15,1,0,"require"],[10,22,1,0],[10,23,1,0,"_dependencyMap"],[10,37,1,0],[11,2,2,0],[11,6,2,0,"_servicesApi"],[11,18,2,0],[11,21,2,0,"require"],[11,28,2,0],[11,29,2,0,"_dependencyMap"],[11,43,2,0],[12,2,3,0],[12,6,3,0,"_servicesSubscriptionService"],[12,34,3,0],[12,37,3,0,"require"],[12,44,3,0],[12,45,3,0,"_dependencyMap"],[12,59,3,0],[13,2,4,0],[13,6,4,0,"_AuthContext"],[13,18,4,0],[13,21,4,0,"require"],[13,28,4,0],[13,29,4,0,"_dependencyMap"],[13,43,4,0],[14,2,4,40],[14,6,4,40,"_reactJsxDevRuntime"],[14,25,4,40],[14,28,4,40,"require"],[14,35,4,40],[14,36,4,40,"_dependencyMap"],[14,50,4,40],[15,2,15,0],[15,8,15,6,"SubscriptionContext"],[15,27,15,25],[15,43,15,28],[15,47,15,28,"createContext"],[15,53,15,41],[15,54,15,41,"createContext"],[15,67,15,41],[15,69,15,79,"undefined"],[15,78,15,88],[15,79,15,89],[16,2,17,7],[16,11,17,16,"SubscriptionProvider"],[16,31,17,36,"SubscriptionProvider"],[16,32,17,37],[17,4,17,39,"children"],[18,2,17,79],[18,3,17,80],[18,5,17,82],[19,4,18,2],[19,10,18,8],[20,6,18,10,"user"],[21,4,18,15],[21,5,18,16],[21,8,18,19],[21,12,18,19,"useAuth"],[21,24,18,26],[21,25,18,26,"useAuth"],[21,32,18,26],[21,34,18,27],[21,35,18,28],[22,4,19,2],[22,10,19,8],[22,11,19,9,"isPremium"],[22,20,19,18],[22,22,19,20,"setIsPremium"],[22,34,19,32],[22,35,19,33],[22,38,19,36],[22,42,19,36,"useState"],[22,48,19,44],[22,49,19,44,"useState"],[22,57,19,44],[22,59,19,45],[22,64,19,50],[22,65,19,51],[23,4,20,2],[23,10,20,8],[23,11,20,9,"isTrial"],[23,18,20,16],[23,20,20,18,"setIsTrial"],[23,30,20,28],[23,31,20,29],[23,34,20,32],[23,38,20,32,"useState"],[23,44,20,40],[23,45,20,40,"useState"],[23,53,20,40],[23,55,20,41],[23,60,20,46],[23,61,20,47],[24,4,21,2],[24,10,21,8],[24,11,21,9,"isLoading"],[24,20,21,18],[24,22,21,20,"setIsLoading"],[24,34,21,32],[24,35,21,33],[24,38,21,36],[24,42,21,36,"useState"],[24,48,21,44],[24,49,21,44,"useState"],[24,57,21,44],[24,59,21,45],[24,63,21,49],[24,64,21,50],[25,4,22,2],[25,10,22,8],[25,11,22,9,"expiresAt"],[25,20,22,18],[25,22,22,20,"setExpiresAt"],[25,34,22,32],[25,35,22,33],[25,38,22,36],[25,42,22,36,"useState"],[25,48,22,44],[25,49,22,44,"useState"],[25,57,22,44],[25,59,22,58],[25,63,22,62],[25,64,22,63],[26,4,24,2],[26,8,24,2,"useEffect"],[26,14,24,11],[26,15,24,11,"useEffect"],[26,24,24,11],[26,26,24,12],[26,32,24,18],[27,6,25,4],[27,10,25,8,"user"],[27,14,25,12],[27,16,25,14],[28,8,26,6,"initializeSubscription"],[28,30,26,28],[28,31,26,29],[28,32,26,30],[29,6,27,4],[30,4,28,2],[30,5,28,3],[30,7,28,5],[30,8,28,6,"user"],[30,12,28,10],[30,13,28,11],[30,14,28,12],[31,4,30,2],[31,10,30,8,"initializeSubscription"],[31,32,30,30],[31,35,30,33],[31,41,30,33,"initializeSubscription"],[31,42,30,33],[31,47,30,45],[32,6,31,4],[32,10,31,8],[33,8,32,6],[34,8,33,6],[34,12,33,10,"user"],[34,16,33,14],[34,18,33,16,"_id"],[34,21,33,19],[34,23,33,21],[35,10,34,8],[35,16,34,14,"subscriptionService"],[35,44,34,33],[35,45,34,33,"subscriptionService"],[35,64,34,33],[35,65,34,34,"initialize"],[35,75,34,44],[35,76,34,45,"user"],[35,80,34,49],[35,81,34,50,"_id"],[35,84,34,53],[35,85,34,54],[36,8,35,6],[38,8,37,6],[39,8,38,6],[39,14,38,12,"checkSubscription"],[39,31,38,29],[39,32,38,30],[39,33,38,31],[40,6,39,4],[40,7,39,5],[40,8,39,6],[40,15,39,13,"error"],[40,20,39,18],[40,22,39,20],[41,8,40,6,"console"],[41,15,40,13],[41,16,40,14,"error"],[41,21,40,19],[41,22,40,20],[41,57,40,55],[41,59,40,57,"error"],[41,64,40,62],[41,65,40,63],[42,6,41,4],[42,7,41,5],[42,16,41,14],[43,8,42,6,"setIsLoading"],[43,20,42,18],[43,21,42,19],[43,26,42,24],[43,27,42,25],[44,6,43,4],[45,4,44,2],[45,5,44,3],[46,4,46,2],[46,10,46,8,"checkSubscription"],[46,27,46,25],[46,30,46,28],[46,36,46,28,"checkSubscription"],[46,37,46,28],[46,42,46,40],[47,6,47,4],[47,10,47,8],[48,8,48,6,"setIsLoading"],[48,20,48,18],[48,21,48,19],[48,25,48,23],[48,26,48,24],[50,8,50,6],[51,8,51,6],[51,14,51,12,"response"],[51,22,51,20],[51,25,51,23],[51,31,51,29,"subscriptionAPI"],[51,43,51,44],[51,44,51,44,"subscriptionAPI"],[51,59,51,44],[51,60,51,45,"getStatus"],[51,69,51,54],[51,70,51,55],[51,71,51,56],[52,8,52,6],[52,14,52,12,"status"],[52,20,52,18],[52,23,52,21,"response"],[52,31,52,29],[52,32,52,30,"data"],[52,36,52,34],[53,8,54,6,"setIsPremium"],[53,20,54,18],[53,21,54,19,"status"],[53,27,54,25],[53,28,54,26,"isActive"],[53,36,54,34],[53,37,54,35],[54,8,55,6,"setIsTrial"],[54,18,55,16],[54,19,55,17,"status"],[54,25,55,23],[54,26,55,24,"isTrial"],[54,33,55,31],[54,34,55,32],[55,8,56,6,"setExpiresAt"],[55,20,56,18],[55,21,56,19,"status"],[55,27,56,25],[55,28,56,26,"expiresAt"],[55,37,56,35],[55,40,56,38],[55,44,56,42,"Date"],[55,48,56,46],[55,49,56,47,"status"],[55,55,56,53],[55,56,56,54,"expiresAt"],[55,65,56,63],[55,66,56,64],[55,69,56,67],[55,73,56,71],[55,74,56,72],[57,8,58,6],[58,8,59,6],[58,14,59,12,"revenueCatStatus"],[58,30,59,28],[58,33,59,31],[58,39,59,37,"subscriptionService"],[58,67,59,56],[58,68,59,56,"subscriptionService"],[58,87,59,56],[58,88,59,57,"checkSubscription"],[58,105,59,74],[58,106,59,75],[58,107,59,76],[60,8,61,6],[61,8,62,6],[61,12,62,10,"revenueCatStatus"],[61,28,62,26],[61,29,62,27,"isActive"],[61,37,62,35],[61,41,62,39],[61,42,62,40,"status"],[61,48,62,46],[61,49,62,47,"isActive"],[61,57,62,55],[61,59,62,57],[62,10,63,8,"setIsPremium"],[62,22,63,20],[62,23,63,21],[62,27,63,25],[62,28,63,26],[63,10,64,8,"setIsTrial"],[63,20,64,18],[63,21,64,19,"revenueCatStatus"],[63,37,64,35],[63,38,64,36,"isTrial"],[63,45,64,43],[63,46,64,44],[64,10,65,8,"setExpiresAt"],[64,22,65,20],[64,23,65,21,"revenueCatStatus"],[64,39,65,37],[64,40,65,38,"expiresAt"],[64,49,65,47],[64,50,65,48],[65,8,66,6],[66,6,68,4],[66,7,68,5],[66,8,68,6],[66,15,68,13,"error"],[66,20,68,18],[66,22,68,20],[67,8,69,6,"console"],[67,15,69,13],[67,16,69,14,"error"],[67,21,69,19],[67,22,69,20],[67,55,69,53],[67,57,69,55,"error"],[67,62,69,60],[67,63,69,61],[68,8,70,6],[69,8,71,6,"setIsPremium"],[69,20,71,18],[69,21,71,19],[69,25,71,23],[69,26,71,24],[70,6,72,4],[70,7,72,5],[70,16,72,14],[71,8,73,6,"setIsLoading"],[71,20,73,18],[71,21,73,19],[71,26,73,24],[71,27,73,25],[72,6,74,4],[73,4,75,2],[73,5,75,3],[74,4,77,2],[74,10,77,8,"startTrial"],[74,20,77,18],[74,23,77,21],[74,29,77,21,"startTrial"],[74,30,77,21],[74,35,77,51],[75,6,78,4],[75,10,78,8],[76,8,79,6],[76,14,79,12,"response"],[76,22,79,20],[76,25,79,23],[76,31,79,29,"subscriptionAPI"],[76,43,79,44],[76,44,79,44,"subscriptionAPI"],[76,59,79,44],[76,60,79,45,"startTrial"],[76,70,79,55],[76,71,79,56],[76,72,79,57],[77,8,81,6],[77,12,81,10,"response"],[77,20,81,18],[77,21,81,19,"data"],[77,25,81,23],[77,26,81,24,"success"],[77,33,81,31],[77,35,81,33],[78,10,82,8,"setIsPremium"],[78,22,82,20],[78,23,82,21],[78,27,82,25],[78,28,82,26],[79,10,83,8,"setIsTrial"],[79,20,83,18],[79,21,83,19],[79,25,83,23],[79,26,83,24],[80,10,84,8,"setExpiresAt"],[80,22,84,20],[80,23,84,21],[80,27,84,25,"Date"],[80,31,84,29],[80,32,84,30,"response"],[80,40,84,38],[80,41,84,39,"data"],[80,45,84,43],[80,46,84,44,"expiresAt"],[80,55,84,53],[80,56,84,54],[80,57,84,55],[81,10,85,8],[81,17,85,15],[81,21,85,19],[82,8,86,6],[83,8,88,6],[83,15,88,13],[83,20,88,18],[84,6,89,4],[84,7,89,5],[84,8,89,6],[84,15,89,13,"error"],[84,20,89,18],[84,22,89,20],[85,8,90,6,"console"],[85,15,90,13],[85,16,90,14,"error"],[85,21,90,19],[85,22,90,20],[85,47,90,45],[85,49,90,47,"error"],[85,54,90,52],[85,55,90,53],[86,8,91,6],[86,15,91,13],[86,20,91,18],[87,6,92,4],[88,4,93,2],[88,5,93,3],[89,4,95,2],[89,24,96,4],[89,28,96,4,"_reactJsxDevRuntime"],[89,47,96,4],[89,48,96,4,"jsxDEV"],[89,54,96,4],[89,56,96,5,"SubscriptionContext"],[89,75,96,24],[89,76,96,25,"Provider"],[89,84,96,33],[90,6,97,6,"value"],[90,11,97,11],[90,13,97,13],[91,8,98,8,"isPremium"],[91,17,98,17],[92,8,99,8,"isTrial"],[92,15,99,15],[93,8,100,8,"isLoading"],[93,17,100,17],[94,8,101,8,"expiresAt"],[94,17,101,17],[95,8,102,8,"checkSubscription"],[95,25,102,25],[96,8,103,8,"startTrial"],[97,6,104,6],[97,7,104,8],[98,6,104,8,"children"],[98,14,104,8],[98,16,106,7,"children"],[99,4,106,15],[100,6,106,15,"fileName"],[100,14,106,15],[100,16,106,15,"_jsxFileName"],[100,28,106,15],[101,6,106,15,"lineNumber"],[101,16,106,15],[102,6,106,15,"columnNumber"],[102,18,106,15],[103,4,106,15],[103,11,107,34],[103,12,107,35],[104,2,109,0],[105,2,111,7],[105,11,111,16,"useSubscription"],[105,26,111,31,"useSubscription"],[105,27,111,31],[105,29,111,34],[106,4,112,2],[106,10,112,8,"context"],[106,17,112,15],[106,20,112,18],[106,24,112,18,"useContext"],[106,30,112,28],[106,31,112,28,"useContext"],[106,41,112,28],[106,43,112,29,"SubscriptionContext"],[106,62,112,48],[106,63,112,49],[107,4,113,2],[107,8,113,6,"context"],[107,15,113,13],[107,20,113,18,"undefined"],[107,29,113,27],[107,31,113,29],[108,6,114,4],[108,12,114,10],[108,16,114,14,"Error"],[108,21,114,19],[108,22,114,20],[108,82,114,80],[108,83,114,81],[109,4,115,2],[110,4,116,2],[110,11,116,9,"context"],[110,18,116,16],[111,2,117,0],[112,0,117,1],[112,3]],"functionMap":{"names":["<global>","SubscriptionProvider","useEffect$argument_0","initializeSubscription","checkSubscription","startTrial","useSubscription"],"mappings":"AAA;OCgB;YCO;GDI;iCEE;GFc;4BGE;GH6B;qBIE;GJgB;CDgB;OME;CNM"},"hasCjsExports":false},"type":"js/module"}]}